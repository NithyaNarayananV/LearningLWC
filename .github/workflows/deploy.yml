name: Salesforce CI/CD Pipeline (OAuth Authentication)

on:
  push:
    branches:
      - main
      - feature-branch


jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install Salesforce CLI
      uses: amtrack/sfdx-cli-action@v1
      with:
        version: latest

    - name: Authenticate with Salesforce
      run: echo ${{ secrets.SFDX_AUTH_URL }} > sfdx-auth-url.txt && sfdx auth:sfdxurl:store --urlfile sfdx-auth-url.txt --setdefaultusername

    - name: Validate deployment
      run: sfdx force:source:deploy -p force-app --checkonly

    - name: Deploy to Salesforce
      run: sfdx force:source:deploy -p 